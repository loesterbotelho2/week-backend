version: "3.8"

services:
    backend:
      image: loesterbotelho/backend:v1
      container_name: backend
      restart: always
      build:
        context: .
        dockerfile: backend.dockerfile
      environment:
        - SPRING_PROFILES_ACTIVE=prod   
        - SPRING_DATASOURCE_URL=jdbc:postgresql://34.252.79.7:5432/postgres
        - SPRING_DATASOURCE_USERNAME=postgres
        - SPRING_DATASOURCE_PASSWORD=PA@password
      ports:
        - "8080:8080"
      healthcheck:
        test: ["CMD", "curl", "-f", "http://34.252.79.7:8080/health"]
        interval: 30s
        timeout: 10s
        retries: 5
      networks:
        loester-network:
          ipv4_address: 192.168.12.110
      volumes:
        - backend_data:/app/data


volumes:
  backend_data:
    driver: local

networks:
  loester-network:
    driver: bridge
    ipam:
      config:
        - subnet: 192.168.12.0/24
